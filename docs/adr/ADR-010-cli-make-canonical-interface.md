---
type: decision
id: ADR-010
title: CLI & Make targets as canonical interface
date: 2025-09-19
status: accepted
owners: [kira-core]
related: [ADR-001, ADR-002, ADR-003, ADR-007, ADR-009, ADR-015]
drivers: [DX, automation, reproducibility, consistency]
---

## Context

We need a single, canonical interface to run workflows locally and in CI. The CLI should cover end-to-end scenarios; Make targets map to CLI to keep automation simple and discoverable.

## Decision

Adopt `kira` CLI as the canonical entry point, and Make targets as thin wrappers around CLI commands.

- CLI commands (initial set):
  - `kira inbox`
  - `kira calendar pull|push`
  - `kira rollup daily|weekly`
  - `kira ext list|install|enable|disable`
  - `kira validate`

- Make targets map 1:1 to CLI with sensible defaults. Documentation includes runnable examples.

## Alternatives

- Ad-hoc scripts — non-uniform and hard to maintain. Rejected.

## Implementation/Migration

1) CLI modules under `src/kira/cli/` with `__main__.py` as the entry point.
2) Autogenerated help/usage via argparse; examples included in help epilog.
3) Makefile targets that call the CLI; ensure non-interactive flags for CI safety.
4) Documentation in `docs/cli.md` with copy/paste examples.

## Risks

- CLI sprawl — group by subcommands and deprecate gently.
- Divergence between Make and CLI — keep Make as a thin wrapper and test both.

## Metrics/DoD

Acceptance criteria (Definition of Done):

- Coverage:
  - All common workflows (inbox, calendar sync, rollup, ext management, validate) are runnable via CLI and mirrored via Make.

- Help/UX:
  - `kira -h` and subcommand `-h` show examples and exit zero; commands support `--verbose` where applicable.

- CI:
  - CI jobs invoke Make targets which call CLI with non-interactive flags and produce JSONL logs (ADR-015).

- Docs:
  - `docs/cli.md` contains copy/paste examples that run successfully.
