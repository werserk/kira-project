# Hot Reload –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Hot Reload

–í dev-–æ–∫—Ä—É–∂–µ–Ω–∏–∏ (`compose.dev.yaml`) –∫–æ–¥ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω** –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```yaml
volumes:
  # Hot-reload: mount source code (read-write for auto-reload)
  - ./src/kira:/app/src/kira:rw
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ **–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ —Å—Ä–∞–∑—É –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ** –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞!

## –ë—ã—Å—Ç—Ä—ã–π workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π –∫–æ–¥

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–π –ª—é–±–æ–π —Ñ–∞–π–ª –≤ src/kira/
vim src/kira/agent/nodes.py
```

### 2. –ü—Ä–∏–º–µ–Ω—è–π –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–í–∞—Ä–∏–∞–Ω—Ç A: –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
make restart
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –í—Ä—É—á–Ω—É—é**
```bash
make down
make up
```

**–í–∞—Ä–∏–∞–Ω—Ç C: –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**
```bash
docker restart kira-telegram-dev
```

### 3. –ü—Ä–æ–≤–µ—Ä—è–π –ª–æ–≥–∏

```bash
make logs
# –∏–ª–∏
docker logs -f kira-telegram-dev
```

## –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω rebuild

–ò—Å–ø–æ–ª—å–∑—É–π `make rebuild` **—Ç–æ–ª—å–∫–æ** –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª:

- ‚ùå –ö–æ–¥ –≤ `src/kira/` ‚Üí **–ù–ï–¢**, –∏—Å–ø–æ–ª—å–∑—É–π `make restart`
- ‚úÖ `pyproject.toml` (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏) ‚Üí **–î–ê**, –∏—Å–ø–æ–ª—å–∑—É–π `make rebuild`
- ‚úÖ `Dockerfile.dev` ‚Üí **–î–ê**, –∏—Å–ø–æ–ª—å–∑—É–π `make rebuild`
- ‚úÖ System packages ‚Üí **–î–ê**, –∏—Å–ø–æ–ª—å–∑—É–π `make rebuild`
- ‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `.env` ‚Üí **–ù–ï–¢**, –∏—Å–ø–æ–ª—å–∑—É–π `make restart`

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥

| –ö–æ–º–∞–Ω–¥–∞ | –í—Ä–µ–º—è | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|---------|-------|-------------------|
| `make restart` | ~10 —Å–µ–∫ | **–ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞** (–µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞) |
| `make rebuild` | ~2-3 –º–∏–Ω | –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π/Dockerfile |
| `docker restart` | ~5 —Å–µ–∫ | –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π, –Ω–æ –±–µ–∑ down/up |

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Hot Reload (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ** –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∫–æ–¥–∞, –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å watchdog:

### –í–∞—Ä–∏–∞–Ω—Ç 1: watchmedo (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)

–ò–∑–º–µ–Ω–∏ –∫–æ–º–∞–Ω–¥—É –≤ `compose.dev.yaml`:

```yaml
# –í–º–µ—Å—Ç–æ:
command: poetry run kira telegram start --verbose

# –ò—Å–ø–æ–ª—å–∑—É–π:
command: >
  watchmedo auto-restart
  --directory=/app/src/kira
  --pattern=*.py
  --recursive
  -- poetry run kira telegram start --verbose
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: nodemon (—Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏)

```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
pip install nodemon
nodemon --watch /app/src/kira --exec "poetry run kira telegram start --verbose"
```

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª –∫–æ–¥, –Ω–æ –ö–∏—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# 1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ
make down
ENV=dev make up

# 2. –ü—Ä–æ–≤–µ—Ä—å volume mapping
docker inspect kira-telegram-dev | grep -A5 Mounts

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
make restart
```

### "Permission denied" –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ –º–æ–≥—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –í–µ—Ä–Ω–∏ –ø—Ä–∞–≤–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
sudo chown -R $USER:$USER src/kira/
```

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Python imports

**–ü—Ä–æ–±–ª–µ–º–∞**: Python –∫–µ—à–∏—Ä—É–µ—Ç –∏–º–ø–æ—Ä—Ç—ã, –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –≤–∏–¥–Ω—ã

**–†–µ—à–µ–Ω–∏–µ**:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `make restart`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π `importlib.reload()` –¥–ª—è hot-reload –º–æ–¥—É–ª–µ–π

## Best Practices

### ‚úÖ DO

- –ò—Å–ø–æ–ª—å–∑—É–π `make restart` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞
- –†–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª—ã –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
- –ü—Ä–æ–≤–µ—Ä—è–π –ª–æ–≥–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ö–æ–º–º–∏—Ç–∏—Ä—É–π —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–¥

### ‚ùå DON'T

- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `make rebuild` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ù–µ –∑–∞–±—ã–≤–∞–π –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
- –ù–µ –∫–æ–º–º–∏—Ç–∏—Ä—É–π –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞

```bash
# 1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–æ–¥
vim src/kira/agent/nodes.py

# 2. –ü—Ä–∏–º–µ–Ω—è–µ–º
make restart

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
make logs

# 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤ Telegram
# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É...

# 5. –ï—Å–ª–∏ –æ–∫ - –∫–æ–º–º–∏—Ç–∏–º
git add src/kira/agent/nodes.py
git commit -m "fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –∑–∞–¥–∞—á"
```

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏—á–∏

```bash
# 1. –°–æ–∑–¥–∞–µ–º –≤–µ—Ç–∫—É
git checkout -b feature/new-tool

# 2. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–æ–¥
vim src/kira/agent/kira_tools.py

# 3. –ë—ã—Å—Ç—Ä–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º —Å restart
make restart
# ... —Ç–µ—Å—Ç–∏—Ä—É–µ–º ...

# 4. –ü–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª edit -> restart -> test
# –ø–æ–∫–∞ —Ñ–∏—á–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞

# 5. –ö–æ–º–º–∏—Ç–∏–º
git commit -am "feat: –¥–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç"
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –í—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

```bash
# –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ restart
time make restart

# –û–±—ã—á–Ω–æ:
# - make restart: ~10 —Å–µ–∫—É–Ω–¥
# - make rebuild: ~2-3 –º–∏–Ω—É—Ç—ã
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é alias

–î–æ–±–∞–≤—å –≤ `~/.bashrc`:

```bash
alias kr='make restart'
alias kl='make logs'
alias kd='make down'
alias ku='make up'
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ:
```bash
kr  # –≤–º–µ—Å—Ç–æ make restart
kl  # –≤–º–µ—Å—Ç–æ make logs
```

---

**TL;DR**: –†–µ–¥–∞–∫—Ç–∏—Ä—É–π –∫–æ–¥ ‚Üí `make restart` ‚Üí Profit! üöÄ

