# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –ø–∞–º—è—Ç—å

## üéâ –ö–∏—Ä–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–º–Ω–∏—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä—ã!

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Phase 1 Kira —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤ –≤ SQLite –∏ –ø–æ–º–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∞–∂–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

---

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Telegram –±–æ—Ç–∞

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ –≤ .env (–¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
kira telegram start
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Docker:

```bash
make telegram-start
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å

**–ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å:**
```
–í—ã: –ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç –ú–∞–∫—Å–∏–º
–ö–∏—Ä–∞: –ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, –ú–∞–∫—Å–∏–º! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
```

**–í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å (–≤ —Ç–æ–π –∂–µ —Å–µ—Å—Å–∏–∏):**
```
–í—ã: –ö–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç?
–ö–∏—Ä–∞: –í–∞—Å –∑–æ–≤—É—Ç –ú–∞–∫—Å–∏–º! üëç
```

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
```bash
# Ctrl+C
kira telegram start
```

**–¢—Ä–µ—Ç–∏–π –∑–∞–ø—Ä–æ—Å (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞):**
```
–í—ã: –ß—Ç–æ —è —Å–ø—Ä–æ—Å–∏–ª –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –≤–æ–ø—Ä–æ—Å–µ?
–ö–∏—Ä–∞: –í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –≤–æ–ø—Ä–æ—Å–µ –≤—ã —Å–ø—Ä–æ—Å–∏–ª–∏ "–ö–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç?"
```

‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç!** –ü–∞–º—è—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

---

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `src/kira/agent/persistent_memory.py` - SQLite –ø–∞–º—è—Ç—å
- ‚úÖ `tests/unit/test_persistent_memory.py` - –¢–µ—Å—Ç—ã (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- ‚úÖ `docs/guides/persistent-memory.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `src/kira/agent/langgraph_executor.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
- ‚úÖ `src/kira/agent/unified_executor.py` - –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ `src/kira/agent/config.py` - –ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ `src/kira/config/settings.py` - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ .env
- ‚úÖ `.env` - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ `CHANGELOG.md` - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`

```bash
# Persistent Memory (survives restarts)
ENABLE_PERSISTENT_MEMORY=true
MEMORY_DB_PATH=artifacts/conversations.db

# Maximum exchanges to keep per session
MEMORY_MAX_EXCHANGES=10
```

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** –í–∫–ª—é—á–µ–Ω–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –ø–∞–º—è—Ç—å —Å 10 –æ–±–º–µ–Ω–∞–º–∏ –Ω–∞ —Å–µ—Å—Å–∏—é.

---

## –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø–∞–º—è—Ç–∏

### –ß–µ—Ä–µ–∑ Python API:

```python
from pathlib import Path
from kira.agent.persistent_memory import PersistentConversationMemory

# –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑–µ
memory = PersistentConversationMemory(
    db_path=Path("artifacts/conversations.db"),
    max_exchanges=10,
)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π
print(f"Active sessions: {memory.get_session_count()}")

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π
sessions = memory.get_all_sessions()
for session_id in sessions:
    print(f"Session: {session_id}")
    turns = memory.get_turns(session_id)
    print(f"  Turns: {len(turns)}")

# –≠–∫—Å–ø–æ—Ä—Ç —Å–µ—Å—Å–∏–∏
export = memory.export_session("telegram:123456789")
print(export)
```

### –ß–µ—Ä–µ–∑ SQLite:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
sqlite3 artifacts/conversations.db

# SQL –∑–∞–ø—Ä–æ—Å—ã
SELECT session_id, COUNT(*) as messages
FROM conversations
GROUP BY session_id;

SELECT role, content, timestamp
FROM conversations
WHERE session_id = 'telegram:123456'
ORDER BY timestamp;
```

---

## –¢–µ—Å—Ç—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å unit —Ç–µ—Å—Ç—ã
pytest tests/unit/test_persistent_memory.py -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/unit/test_persistent_memory.py --cov=kira.agent.persistent_memory --cov-report=html

# –í—Å–µ —Ç–µ—Å—Ç—ã –∞–≥–µ–Ω—Ç–∞
pytest tests/unit/test_agent*.py tests/unit/test_persistent_memory.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
tests/unit/test_persistent_memory.py::test_initialization PASSED
tests/unit/test_persistent_memory.py::test_add_turn PASSED
tests/unit/test_persistent_memory.py::test_get_context_messages PASSED
tests/unit/test_persistent_memory.py::test_persistence_across_instances PASSED
...
======================== 24 passed in 0.5s =========================
```

---

## –û—Ç–∫–ª—é—á–∏—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—É—é –ø–∞–º—è—Ç—å

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —ç—Ñ–µ–º–µ—Ä–Ω–æ–π (RAM-only) –ø–∞–º—è—Ç–∏:

```bash
# –í .env
ENABLE_PERSISTENT_MEMORY=false
```

–ò–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ:

```python
from kira.agent.langgraph_executor import LangGraphExecutor

executor = LangGraphExecutor(
    llm_adapter=llm,
    tool_registry=registry,
    enable_persistent_memory=False,  # ‚Üê –≠—Ñ–µ–º–µ—Ä–Ω–∞—è
    memory_max_exchanges=3,
)
```

---

## Troubleshooting

### –ë–∞–∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞

```bash
rm artifacts/conversations.db
kira telegram start
```

### –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è –±–∞–∑–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä
du -h artifacts/conversations.db

# –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–µ—Å—Å–∏–∏ (–±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤ Phase 2)
sqlite3 artifacts/conversations.db "DELETE FROM conversations WHERE session_id = 'old_session';"
```

### –ü–∞–º—è—Ç—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
from kira.config.settings import load_settings
settings = load_settings()
print(f"Persistent: {settings.enable_persistent_memory}")
print(f"DB: {settings.memory_db_path}")
print(f"Max: {settings.memory_max_exchanges}")
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (Phase 2-3)

- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π (TTL)
- üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
- üß† Long-term memory –≤ vault (Obsidian-compatible)
- üîç –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: `docs/guides/persistent-memory.md`
- **–ö–æ–¥**: `src/kira/agent/persistent_memory.py`
- **–¢–µ—Å—Ç—ã**: `tests/unit/test_persistent_memory.py`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
**–í–µ—Ä—Å–∏—è:** 0.1.0-alpha
**–î–∞—Ç–∞:** 2025-10-10

